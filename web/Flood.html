<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Project</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/ionicons.min.css">
    <link rel="stylesheet" href="assets/css/Campaign-Progress--Summary-Panel.css">
    <link rel="stylesheet" href="assets/css/Contact-Form-v2-Modal--Full-with-Google-Map.css">
    <link rel="stylesheet" href="assets/css/Drag--Drop-Upload-Form.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/css/pikaday.min.css">
    <link rel="stylesheet" href="assets/css/Login-Form-Clean.css">
    <link rel="stylesheet" href="assets/css/Pretty-Registration-Form.css">
</head>

<body>
 <nav class="navbar navbar-dark navbar-expand-lg fixed-top bg-white portfolio-navbar gradient">
        <div class="container"><img src="assets/img/avatars/logo.png" alt="logo" height="42" width="42"><a class="navbar-brand logo" href="index.html">HelpingHands</a>
		<span style="font-size: larger;">ايادي العون</span><button class="navbar-toggler" data-toggle="collapse" data-target="#navbarNav"><span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse"
                id="navbarNav">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item" role="presentation"><a class="nav-link active" href="index.html">Home</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" href="Donations.html">Projects</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" href="About%20Us.html">About Us</a></li>
                    <li class="nav-item" role="presentation"><a class="nav-link" href="Login.html">Login</a></li>
                </ul>
            </div>
        </div>
    </nav>
	 <div class="container" id="needs">
	 <br><br><br><br><br>
  <center>
    <div id="target">

    </div>
    <br>
   <h1>How Can You Help?</h1></center><br>
<!--
    <div class="card">
        <div class="card-body">
		<div class="row">
		<img src="assets/img/avatars/red.png" height="50%" width="50%"  style="display: block; margin-left: auto;margin-right: auto;width: 50%;">
		</div>
		<br><br>
			<div class="row">
			<div class="col-md">
			<center><p>Des</p></center>
			</div>
			</div>
			<br><br>
            <div class="row">
			     <div class="col"> <p style="width: 200px;">Item Name</p></div>
				 <div class="col"></div> <div class="col"></div>
					<div class="col"><img src="assets/img/avatars/red.png" alt="logo" height="42" width="55" ><p>Red Cross</p></div>
					<div class="col"><a class="btn btn-primary btn-block button" href="charity.html"style="background: blue;" >Donate</a></div>


			</div>
            <div class="progress" style="height: 40px;">
                <div class="progress-bar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%;">70%</div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p>Raised:&nbsp;<br>
<small class="text-muted"><i class="fa fa-heart text-primary"></i>128 Donations</small></p>
                </div>
                <div class="col-md-6">
                    <p class="text-right">Goal: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br>
<small class="text-muted"><i class="fa fa-clock-o text-primary"></i> Ends November 23, 2016</small></p>
                </div>
            </div>
        </div>
		 </div>
	    <div class="card">
        <div class="card-body">
		<div class="row">
		<img src="assets/img/nature/image2.jpg" height="50%" width="50%"  style="display: block; margin-left: auto;margin-right: auto;width: 50%;">
		</div>
		<br><br>
		<div class="row">
			<div class="col-md">
			<center><p>Des</p></center>
			</div>
			</div>
			<br><br>
            <div class="row">
			     <div class="col"> <p style="width: 200px;">Item Name</p></div>
				 <div class="col"></div> <div class="col"></div>
					<div class="col"><img src="assets/img/avatars/unicef.png" alt="logo" height="42" width="55" ><p>Unicef</p></div>
					<div class="col"><a class="btn btn-primary btn-block button" href="Medical.html"style="background: blue;" >Help</a></div>


			</div>
            <div class="progress" style="height: 40px;">
                <div class="progress-bar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%;">70%</div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p>Raised:&nbsp;<br>
<small class="text-muted"><i class="fa fa-heart text-primary"></i>128 Donations</small></p>
                </div>
                <div class="col-md-6">
                    <p class="text-right">Goal: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br>
<small class="text-muted"><i class="fa fa-clock-o text-primary"></i> Ends November 23, 2016</small></p>
                </div>
            </div>
        </div>
		 </div>
     -->
	 </div><br>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/bs-animation.js"></script>
    <script src="assets/js/Contact-Form-v2-Modal--Full-with-Google-Map.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/pikaday.min.js"></script>
    <script src="assets/js/theme.js"></script>
</body>

<footer class="page-footer">
    <div class="container">
        <div class="links"><a href="About%20Us.html
            ">About Us</a></div>
        <div class="social-icons"><a href="#"><i class="icon ion-social-facebook"></i></a><a href="#"><i class="icon ion-social-instagram-outline"></i></a><a href="#"><i class="icon ion-social-twitter"></i></a></div>
    </div>
</footer>

</html>

<script>

projectId = window.location.hash.substr(1);

url = "http://localhost:3000/crisis/"+projectId;

function createItem(title, description, location, peopleAffected, deaths, date, image)  {
    const item = `

    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {
  box-sizing: border-box;
}

/* Create two equal columns that floats next to each other */
.column {
  float: left;
  width: 50%;
  padding: 10px;
  height: 100%; /* Should be removed. Only for demonstration */
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}
</style>
</head>
<body>

<h1>${title}</h1>
<p>Location : ${location}</p>

<div class="row">
  <div class="column" style="background-color:#f4f4f4; float: left; text-align: left; min-height: 320px;">
    <p style="">${description}</p>
    <p>Affected People : ${peopleAffected}</p>
    <p>Deaths: ${deaths}</p>
    <p>Date: ${date.substring(0,10)}</p>
  </div>
  <div class="column" style="background-color:#f4f4f4; height:100%; min-height: 320px;">
    <img style="width: 100%; height: auto;max-height: 300px" src = ${image}>
  </div>
</div>`;
    return item;
}

function createNeed(name, required, provided, charityImgUrl, charityName, charityUrl, donate, needUrl) {
    // if donate is true, then button is Donate. If it is false, then the button is Volunteer
    // charityImgUrl -  = 'http://lofrev.net/wp-content/photos/2016/06/red_cross_logo.png'
    // charityName = 'Red Cross'
    // donate = true
    console.log(needUrl);

    const percent = Math.round(provided / required * 100);
    const need = `<div class="card-body">
            <h4><small class="display-inline-block pull-right"></small></h4>

            <div class="row">
			    <div class="col"> <p style="width: 200px;">${name}</p></div>
                <div class="col"></div>
                <div class="col"><button onclick="window.location.href='${charityUrl}'" class="btn btn-tertiary" type="button" style="background-color: white; float: right;"><img src="${charityImgUrl}" alt="logo" height="20%" width="20%" vertical-align="center">${charityName}</button></div>
			    <div class="col"><button onclick="window.location.href='${needUrl}'" class="btn btn-primary" type="button" style="float: right;">${donate ? 'Donate' : 'Volunteer'}</button></div>
			</div>
            <div class="progress" style="height: 40px;">
                <div class="progress-bar" aria-valuenow="${percent}" aria-valuemin="0" aria-valuemax="100" style="width: ${percent}%;">${percent}%</div>
            </div>
            <div class="row">
                <div class="col-md-6">

                    <p>Raised:&nbsp;<br>

    <small class="text-muted"><i class="fa fa-heart text-primary"></i>${provided} Donated, ${required} Required</small></p>
                </div>
                <div class="col-md-6">
                    <p class="text-right">Goal: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br>
    <small class="text-muted"><i class="fa fa-clock-o text-primary"></i> Ends November 23, 2016</small></p>
                </div>
            </div>
        </div>`;
    return need;
}

fetch(url, {
    method: 'GET',
}).then(response => response.json())
    .then(async (data) => {
        console.log(data);

        const row = document.getElementById('target');
        row.innerHTML += createItem(data.title, data.description, data.location.city, data.causalities[0].affected_people, data.causalities[0].dead_people, data.date.toString(), data.mediaURL);
       // row.lastElementChild.children[0].

        let needPhysicalUrl = "http://127.0.0.1:3000/needPhysical";
        let physicalNeeds = await fetch(needPhysicalUrl).then(r => r.json());

        let needSkillUrl = "http://127.0.0.1:3000/needSkill";
        let skillNeeds = await fetch(needSkillUrl).then(r => r.json());

        let charities = await fetch('http://127.0.0.1:3000/charity').then(r => r.json());

        console.log('TOTAL: ', physicalNeeds, skillNeeds);
        physicalNeeds = physicalNeeds.filter(need => need.crisisId === projectId);
        skillNeeds = skillNeeds.filter(need => need.crisisId === projectId);

        console.log('filtered: ', physicalNeeds, skillNeeds);

        physicalNeeds.forEach(need => {
            console.log(need);
            let charity = charities.find(charity => charity.charityId === need.charityId);
            document.getElementById('needs').innerHTML += createNeed(
                need.name,
                need.quantity.required,
                need.quantity.provided,
                charity.logoURL,
                charity.name,
                charity.website,
                true,
                'Donate.html#' + need._id
            );
        });

        skillNeeds.forEach(need => {
            let charity = charities.find(charity => charity.charityId === need.charityId);
            document.getElementById('needs').innerHTML += createNeed(
                need.name,
                need.quantity.required,
                need.quantity.provided,
                charity.logoURL,
                charity.name,
                charity.website,
                false,
                'Medical.html#' + need._id
            );
        });
        // function createNeed(name, required, provided, charityImgUrl, charityName, charityUrl, donate, needUrl) {

    });

</script>
